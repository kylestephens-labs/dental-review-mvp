#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running secret detection before commit..."
# Simple secret detection - check for common patterns
if git diff --cached --name-only | xargs grep -l -E "(password|secret|key|token)\s*[:=]\s*['\"][^'\"]{8,}" 2>/dev/null; then
  echo "âŒ Potential secrets detected in staged files"
  echo "ğŸ’¡ Remove or mask sensitive information before committing"
  exit 1
fi

echo "ğŸ” Running prove:quick before commit..."
npm run prove:quick

if [ $? -ne 0 ]; then
  echo "âŒ prove:quick failed - commit blocked"
  echo "ğŸ’¡ Fix the issues above and try again"
  exit 1
fi

echo "âœ… prove:quick passed - commit allowed"
