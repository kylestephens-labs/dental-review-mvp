
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for dental-landing-template/find_best_niche.mjs</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../index.html">All files</a> / <a href="index.html">dental-landing-template</a> find_best_niche.mjs</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/140</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/140</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >import { createClient } from '@supabase/supabase-js';</span></span></span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >const supabaseUrl = 'https://aeznfrekdipwhhpntvue.supabase.co';</span>
<span class="cstat-no" title="statement not covered" >const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY;</span>
<span class="cstat-no" title="statement not covered" >const supabase = createClient(supabaseUrl, supabaseKey);</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >async function findBestNiche() {</span>
<span class="cstat-no" title="statement not covered" >  const targetCities = ['Berkeley', 'Concord', 'Fremont', 'Oakland', 'Pleasanton', 'Walnut Creek'];</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  console.log('=== FINDING BEST NICHE FOR 90-DAY SPRINT ===\n');</span>
<span class="cstat-no" title="statement not covered" >  console.log('Formula: volume × ops_gaps × reachability\n');</span>
<span class="cstat-no" title="statement not covered" >  console.log('Where:');</span>
<span class="cstat-no" title="statement not covered" >  console.log('  - volume = total businesses in niche');</span>
<span class="cstat-no" title="statement not covered" >  console.log('  - ops_gaps = % missing website (proxy for needing help)');</span>
<span class="cstat-no" title="statement not covered" >  console.log('  - reachability = % with phone or email\n');</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  // Fetch all data</span>
<span class="cstat-no" title="statement not covered" >  let allData = [];</span>
<span class="cstat-no" title="statement not covered" >  let from = 0;</span>
<span class="cstat-no" title="statement not covered" >  const batchSize = 1000;</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  while (true) {</span>
<span class="cstat-no" title="statement not covered" >    const { data, error } = await supabase</span>
<span class="cstat-no" title="statement not covered" >      .from('mv_rb_base')</span>
<span class="cstat-no" title="statement not covered" >      .select('*')</span>
<span class="cstat-no" title="statement not covered" >      .range(from, from + batchSize - 1);</span>
<span class="cstat-no" title="statement not covered" >    </span>
<span class="cstat-no" title="statement not covered" >    if (error || !data || data.length === 0) break;</span>
<span class="cstat-no" title="statement not covered" >    allData = allData.concat(data);</span>
<span class="cstat-no" title="statement not covered" >    from += batchSize;</span>
<span class="cstat-no" title="statement not covered" >    if (data.length &lt; batchSize) break;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  const filtered = allData.filter(b =&gt; targetCities.includes(b.city));</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  // Group by niche</span>
<span class="cstat-no" title="statement not covered" >  const nicheGroups = {};</span>
<span class="cstat-no" title="statement not covered" >  filtered.forEach(biz =&gt; {</span>
<span class="cstat-no" title="statement not covered" >    const niche = biz.primary_category || 'Unknown';</span>
<span class="cstat-no" title="statement not covered" >    </span>
<span class="cstat-no" title="statement not covered" >    if (!nicheGroups[niche]) {</span>
<span class="cstat-no" title="statement not covered" >      nicheGroups[niche] = {</span>
<span class="cstat-no" title="statement not covered" >        total: 0,</span>
<span class="cstat-no" title="statement not covered" >        has_website: 0,</span>
<span class="cstat-no" title="statement not covered" >        has_phone: 0,</span>
<span class="cstat-no" title="statement not covered" >        has_email: 0,</span>
<span class="cstat-no" title="statement not covered" >        cities: new Set(),</span>
<span class="cstat-no" title="statement not covered" >        avg_rating: [],</span>
<span class="cstat-no" title="statement not covered" >        review_counts: []</span>
<span class="cstat-no" title="statement not covered" >      };</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" >    </span>
<span class="cstat-no" title="statement not covered" >    nicheGroups[niche].total++;</span>
<span class="cstat-no" title="statement not covered" >    if (biz.website) nicheGroups[niche].has_website++;</span>
<span class="cstat-no" title="statement not covered" >    if (biz.phone) nicheGroups[niche].has_phone++;</span>
<span class="cstat-no" title="statement not covered" >    if (biz.email) nicheGroups[niche].has_email++;</span>
<span class="cstat-no" title="statement not covered" >    if (biz.city) nicheGroups[niche].cities.add(biz.city);</span>
<span class="cstat-no" title="statement not covered" >    if (biz.rating) nicheGroups[niche].avg_rating.push(parseFloat(biz.rating));</span>
<span class="cstat-no" title="statement not covered" >    if (biz.review_count) nicheGroups[niche].review_counts.push(parseInt(biz.review_count));</span>
<span class="cstat-no" title="statement not covered" >  });</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  // Calculate scores with NEW formula</span>
<span class="cstat-no" title="statement not covered" >  const summary = Object.entries(nicheGroups)</span>
<span class="cstat-no" title="statement not covered" >    .filter(([niche, data]) =&gt; data.total &gt;= 30) // Min 30 businesses for volume</span>
<span class="cstat-no" title="statement not covered" >    .map(([niche, data]) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      const pct_missing_website = (1 - (data.has_website / data.total));</span>
<span class="cstat-no" title="statement not covered" >      const pct_reachable = Math.max(data.has_phone, data.has_email) / data.total;</span>
<span class="cstat-no" title="statement not covered" >      const volume_score = data.total;</span>
<span class="cstat-no" title="statement not covered" >      </span>
<span class="cstat-no" title="statement not covered" >      // NEW FORMULA: volume × ops_gaps × reachability</span>
<span class="cstat-no" title="statement not covered" >      const opportunity_score = Math.round(</span>
<span class="cstat-no" title="statement not covered" >        volume_score * pct_missing_website * pct_reachable</span>
<span class="cstat-no" title="statement not covered" >      );</span>
<span class="cstat-no" title="statement not covered" >      </span>
<span class="cstat-no" title="statement not covered" >      return {</span>
<span class="cstat-no" title="statement not covered" >        niche,</span>
<span class="cstat-no" title="statement not covered" >        total: data.total,</span>
<span class="cstat-no" title="statement not covered" >        cities: data.cities.size,</span>
<span class="cstat-no" title="statement not covered" >        has_website: data.has_website,</span>
<span class="cstat-no" title="statement not covered" >        has_phone: data.has_phone,</span>
<span class="cstat-no" title="statement not covered" >        has_email: data.has_email,</span>
<span class="cstat-no" title="statement not covered" >        pct_missing_website: (pct_missing_website * 100).toFixed(1),</span>
<span class="cstat-no" title="statement not covered" >        pct_reachable: (pct_reachable * 100).toFixed(1),</span>
<span class="cstat-no" title="statement not covered" >        missing_website: data.total - data.has_website,</span>
<span class="cstat-no" title="statement not covered" >        avg_rating: data.avg_rating.length ? (data.avg_rating.reduce((a,b) =&gt; a+b, 0) / data.avg_rating.length).toFixed(2) : 'N/A',</span>
<span class="cstat-no" title="statement not covered" >        avg_reviews: data.review_counts.length ? Math.round(data.review_counts.reduce((a,b) =&gt; a+b, 0) / data.review_counts.length) : 'N/A',</span>
<span class="cstat-no" title="statement not covered" >        opportunity_score</span>
<span class="cstat-no" title="statement not covered" >      };</span>
<span class="cstat-no" title="statement not covered" >    })</span>
<span class="cstat-no" title="statement not covered" >    .sort((a, b) =&gt; b.opportunity_score - a.opportunity_score);</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  console.log('TOP 40 NICHES (volume × ops_gaps × reachability):');</span>
<span class="cstat-no" title="statement not covered" >  console.table(summary.slice(0, 40));</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  // Group related niches into clusters</span>
<span class="cstat-no" title="statement not covered" >  const clusters = {</span>
<span class="cstat-no" title="statement not covered" >    'Cleaning': ['house cleaning service', 'carpet cleaning service', 'janitorial service', 'cleaning service', 'cleaners', 'dryer vent cleaning service', 'window cleaning service', 'gutter cleaning service', 'upholstery cleaning service', 'air duct cleaning service', 'pool cleaning service'],</span>
<span class="cstat-no" title="statement not covered" >    'Home Services': ['plumber', 'hvac contractor', 'electrician', 'roofing contractor', 'contractor', 'general contractor', 'air conditioning contractor', 'heating contractor', 'handyman'],</span>
<span class="cstat-no" title="statement not covered" >    'Auto': ['auto repair shop', 'auto body shop', 'auto glass shop', 'car wash', 'oil change service', 'tire shop'],</span>
<span class="cstat-no" title="statement not covered" >    'Dental': ['dentist', 'dental clinic', 'pediatric dentist', 'orthodontist', 'endodontist', 'cosmetic dentist'],</span>
<span class="cstat-no" title="statement not covered" >    'Fitness': ['gym', 'fitness center', 'personal trainer', 'yoga studio', 'pilates studio', 'martial arts school', 'boxing gym'],</span>
<span class="cstat-no" title="statement not covered" >    'Landscaping': ['landscaper', 'landscape designer', 'lawn care service', 'tree service']</span>
<span class="cstat-no" title="statement not covered" >  };</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  console.log('\n\n=== CLUSTER ANALYSIS ===\n');</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  Object.entries(clusters).forEach(([clusterName, niches]) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >    const clusterData = summary.filter(s =&gt; niches.some(n =&gt; s.niche.toLowerCase().includes(n.toLowerCase())));</span>
<span class="cstat-no" title="statement not covered" >    </span>
<span class="cstat-no" title="statement not covered" >    if (clusterData.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >      const totalBiz = clusterData.reduce((sum, s) =&gt; sum + s.total, 0);</span>
<span class="cstat-no" title="statement not covered" >      const totalMissing = clusterData.reduce((sum, s) =&gt; sum + s.missing_website, 0);</span>
<span class="cstat-no" title="statement not covered" >      const totalScore = clusterData.reduce((sum, s) =&gt; sum + s.opportunity_score, 0);</span>
<span class="cstat-no" title="statement not covered" >      const avgReachability = (clusterData.reduce((sum, s) =&gt; sum + parseFloat(s.pct_reachable), 0) / clusterData.length).toFixed(1);</span>
<span class="cstat-no" title="statement not covered" >      </span>
<span class="cstat-no" title="statement not covered" >      console.log(`${clusterName}:`);</span>
<span class="cstat-no" title="statement not covered" >      console.log(`  Total businesses: ${totalBiz}`);</span>
<span class="cstat-no" title="statement not covered" >      console.log(`  Missing websites: ${totalMissing}`);</span>
<span class="cstat-no" title="statement not covered" >      console.log(`  Avg reachability: ${avgReachability}%`);</span>
<span class="cstat-no" title="statement not covered" >      console.log(`  Combined opportunity score: ${totalScore}`);</span>
<span class="cstat-no" title="statement not covered" >      console.log(`  Niches in cluster: ${clusterData.length}`);</span>
<span class="cstat-no" title="statement not covered" >      console.log(`  Top 3 niches:`, clusterData.slice(0, 3).map(s =&gt; `${s.niche} (${s.total})`).join(', '));</span>
<span class="cstat-no" title="statement not covered" >      console.log('');</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" >  });</span>
<span class="cstat-no" title="statement not covered" >  </span>
<span class="cstat-no" title="statement not covered" >  // Best single niche recommendation</span>
<span class="cstat-no" title="statement not covered" >  console.log('\n=== RECOMMENDATION ===\n');</span>
<span class="cstat-no" title="statement not covered" >  const top1 = summary[0];</span>
<span class="cstat-no" title="statement not covered" >  console.log(`Best Single Niche: ${top1.niche}`);</span>
<span class="cstat-no" title="statement not covered" >  console.log(`  - Volume: ${top1.total} businesses`);</span>
<span class="cstat-no" title="statement not covered" >  console.log(`  - Missing websites: ${top1.missing_website} (${top1.pct_missing_website}%)`);</span>
<span class="cstat-no" title="statement not covered" >  console.log(`  - Reachable: ${top1.pct_reachable}%`);</span>
<span class="cstat-no" title="statement not covered" >  console.log(`  - Opportunity Score: ${top1.opportunity_score}`);</span>
<span class="cstat-no" title="statement not covered" >  console.log(`  - Cities: ${top1.cities}`);</span>
<span class="cstat-no" title="statement not covered" >  console.log(`  - Avg Rating: ${top1.avg_rating}`);</span>
<span class="cstat-no" title="statement not covered" >  console.log(`  - Avg Reviews: ${top1.avg_reviews}`);</span>
<span class="cstat-no" title="statement not covered" >}</span>
<span class="cstat-no" title="statement not covered" ></span>
<span class="cstat-no" title="statement not covered" >findBestNiche().catch(console.error);</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-10-12T04:48:44.133Z
            </div>
        <script src="../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../sorter.js"></script>
        <script src="../block-navigation.js"></script>
    </body>
</html>
    